{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import { SetupContext, ref, computed, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport { SelectInputCommonProperties } from './interface';\nimport { TdSelectInputProps } from './type';\nimport Input, { InputValue, TdInputProps } from '../input';\nimport Loading from '../loading';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useDefaultValue from '../hooks/useDefaultValue';\nimport { useFormDisabled } from '../form/hooks';\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  value: 'value',\n  children: 'children',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = { ...DEFAULT_KEYS, ...keys };\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps, context: SetupContext) {\n  const { value, keys, inputValue: propsInputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const inputRef = ref();\n  const [inputValue, setInputValue] = useDefaultValue(\n    propsInputValue,\n    props.defaultInputValue ?? '',\n    props.onInputChange,\n    'inputValue',\n  );\n  const renderTNode = useTNodeJSX();\n  const disable = useFormDisabled();\n\n  const commonInputProps = computed<SelectInputCommonProperties>(() => ({\n    ...pick(props, COMMON_PROPERTIES),\n    disabled: disable.value,\n  }));\n\n  const onInnerClear = (context: { e: MouseEvent }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange: TdInputProps['onChange'] = (value, context) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: context.trigger || 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    const singleValueDisplay = renderTNode('valueDisplay');\n    const displayedValue = popupVisible && props.allowInput ? inputValue.value : getInputValue(value.value, keys.value);\n    const prefixContent = [renderTNode('label'), singleValueDisplay];\n    const inputProps = {\n      ...commonInputProps.value,\n      value: singleValueDisplay ? undefined : displayedValue,\n      label: prefixContent.length ? () => prefixContent : undefined,\n      autoWidth: props.autoWidth,\n      readonly: !props.allowInput || props.readonly,\n      placeholder: singleValueDisplay ? '' : props.placeholder,\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      showClearIconOnEmpty: Boolean(\n        props.clearable && (inputValue.value || displayedValue) && !disable.value && !props.readonly,\n      ),\n      allowTriggerBlur: props.allowInput && !props.readonly,\n      ...props.inputProps,\n    };\n\n    // eslint-disable-next-line\n    const { tips, ...slots } = context.slots;\n\n    const inputClassProps = popupVisible\n      ? [`${classPrefix.value}-input--focused`, `${classPrefix.value}-is-focused`, inputProps?.inputClass]\n      : inputProps?.inputClass;\n\n    return (\n      <Input\n        ref=\"inputRef\"\n        style={context.attrs?.style}\n        v-slots={slots}\n        {...{\n          onChange: onInnerInputChange,\n          onClear: onInnerClear,\n          onBlur: (val: InputValue, context: { e: MouseEvent }) => {\n            props.onBlur?.(value.value, { ...context, inputValue: val });\n          },\n          onEnter: (val: InputValue, context: { e: KeyboardEvent }) => {\n            props.onEnter?.(value.value, { ...context, inputValue: val });\n          },\n          onFocus: (val, context) => {\n            props.onFocus?.(value.value, { ...context, inputValue: val });\n            //删除，下面这行代码不允许恢复！不符合正常逻辑，也会造成 defaultInputValue 无效；树形结构搜索功能异常等问题\n            // !popupVisible && setInputValue(getInputValue(value.value, keys.value), { ...context, trigger: 'input' }); // 聚焦时拿到value\n          },\n          ...inputProps,\n        }}\n        inputClass={inputClassProps}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","children","getInputValue","keys","iKeys","_objectSpread","isObject","useSingle","props","context","_props$defaultInputVa","_toRefs","toRefs","propsInputValue","inputValue","classPrefix","usePrefixClass","inputRef","ref","_useDefaultValue","useDefaultValue","defaultInputValue","onInputChange","_useDefaultValue2","_slicedToArray","setInputValue","renderTNode","useTNodeJSX","disable","useFormDisabled","commonInputProps","computed","pick","disabled","onInnerClear","_context2$e","_props$onClear","e","stopPropagation","onClear","call","trigger","onInnerInputChange","allowInput","renderSelectSingle","popupVisible","_context$attrs","singleValueDisplay","displayedValue","prefixContent","inputProps","length","autoWidth","readonly","placeholder","suffixIcon","loading","_createVNode","Loading","showClearIconOnEmpty","Boolean","clearable","allowTriggerBlur","_context$slots","slots","tips","_objectWithoutProperties","_excluded","inputClassProps","concat","inputClass","Input","_mergeProps","attrs","style","onChange","onBlur","val","_props$onBlur","onEnter","_props$onEnter","onFocus","_props$onFocus"],"mappings":"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"}